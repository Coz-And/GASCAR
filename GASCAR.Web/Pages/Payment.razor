@page "/payments"
@using GASCAR.Web.Models
@using GASCAR.Web.Services

@inject AuthStateService AuthState
@inject NavigationManager Navigation

@inject ApiService Api

<h3>ðŸ’³ Pagamenti</h3>

@if (payments == null)
{
    <p>Caricamento...</p>
}
else if (payments.Count == 0)
{
    <p>Nessun pagamento trovato.</p>
}
else
{
    <ul>
        @foreach (var p in payments)
        {
            <li>
                @p.EndTime.ToString("dd/MM/yyyy HH:mm")
                - â‚¬@p.Amount
                - @p.Type
            </li>
        }
    </ul>
}

@code {
    List<PaymentDto>? payments;

    protected override async Task OnInitializedAsync()
    {
        if (!AuthState.IsAuthenticated || string.IsNullOrEmpty(AuthState.Token))
        {
            Navigation.NavigateTo("/login", true);
            return;
        }
        payments = await Api.GetPayments();
    }
}
